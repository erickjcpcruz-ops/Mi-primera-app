<script src="https://unpkg.com/@worldcoin/idkit-js"></script>

<script>
  // 2. Función para lanzar el inicio de sesión oficial
  async function iniciarSesionWorld() {
    try {
      const result = await IDKit.open({
        app_id: "app_XXXXXXXX", // Tu ID del Developer Portal
        action: "login", // Nombre de la acción
        onSuccess: (res) => {
          console.log("Humano Verificado con éxito:", res);
          // Aquí desbloqueas el botón de video para este ID único
          document.getElementById('btnVer').disabled = false;
          alert("¡Bienvenido, Humano Verificado!");
        },
      });
    } catch (error) {
      console.error("Error en la firma:", error);
    }
  }

  // Modificamos tu función de video para que use la billetera
  async function guardarPuntosConWorldID(nullifier_hash) {
      // Usamos el hash único de Worldcoin como ID en Supabase
      const { error } = await _supabase
        .from('posts')
        .upsert({ 
          telegram_user_id: nullifier_hash, // ID anónimo pero único del humano
          total_points: saldo,
          content: "Puntos vinculados a World ID" 
        });
  }
</script>
